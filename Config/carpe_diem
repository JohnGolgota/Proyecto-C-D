-- VERSION :: DuvanArwenLazar -> Indentation with primary and foreign keys: copiar y pegar en orden
CREATE TABLE tbl_usuario (
    id_usr int(11) AUTO_INCREMENT,
    nombre_usr varchar(30) NOT NULL,
    correo_usr varchar(50) NOT NULL UNIQUE,
    contrasena_usr varchar(255) NOT NULL,

    PRIMARY KEY (id_usr)
);

CREATE TABLE tbl_administrador(
    id_adm int(11) AUTO_INCREMENT,
    nombre_adm varchar(100) NOT NULL,
    correo_adm varchar(50) NOT NULL,
    contacto_ext_adm varchar(150),
    contrasena_adm varchar(255) NOT NULL,

    PRIMARY KEY (id_adm)
);

CREATE TABLE tbl_eventos (
    id_evn int(11) AUTO_INCREMENT,
    nombre_evn varchar(50) NOT NULL, 
    descripcion_evn varchar(255),
    color_evn varchar(8),
    desde_evn datetime NOT NULL, 
    hasta_evn datetime NOT NULL,

    hora_inicio_evn varchar(10) NOT NULL,
    hora_final_evn varchar(10) NOT NULL,

    fecha_evn datetime DEFAULT current_timestamp(),
    id_usr int(11) NOT NULL,

    PRIMARY KEY (id_evn),
    FOREIGN KEY (id_usr) REFERENCES tbl_usuario(id_usr)
);

CREATE TABLE tbl_pomodoro(
    id_pmd int(11) AUTO_INCREMENT,
    fecha_hora_pmd TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    evento_pmd varchar(50),
    actividad_pmd varchar(8),
    pausa_corta_pmd varchar(8) NOT NULL,
    pausa_larga_pmd varchar(8) NOT NULL,
    id_usr int(11) NOT NULL,

    PRIMARY KEY (id_pmd),
    FOREIGN KEY (id_usr) REFERENCES tbl_usuario (id_usr)
);

CREATE TABLE tbl_Recordatorios(
    id_rec int(11) AUTO_INCREMENT,
    Nombre_rec varchar(75),
    Color_rec varchar(8),
    Fecha_rec TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Notificacion_rec DATETIME,

    id_usr int(11),
    PRIMARY KEY(id_rec),
    FOREIGN KEY(id_usr) REFERENCES tbl_usuario(id_usr)
); 

CREATE TABLE tbl_archivo(
    id_arc int(11),
    nombre_arc varchar(75),
    color_arc varchar(8),
    fecha_arc DATETIME,
    fecha_del_arc TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    notificacion_arc DATETIME,
    id_usr int(11),

    PRIMARY KEY(id_arc),
    FOREIGN KEY(id_usr) REFERENCES tbl_usuario(id_usr)
);

-- En linea
CREATE TABLE tbl_usuario (id_usr int(11) NOT NULL AUTO_INCREMENT,nombre_usr varchar(30) NOT NULL UNIQUE,correo_usr varchar(50) NOT NULL UNIQUE,contrasena_usr varchar(255) NOT NULL,PRIMARY KEY (id_usr));
CREATE TABLE tbl_administrador(id_adm int(11) NOT NULL AUTO_INCREMENT,nombre_adm varchar(100) NOT NULL,correo_adm varchar(50) NOT NULL,contacto_ext_adm varchar(150),contrasena_adm varchar(255) NOT NULL,PRIMARY KEY (id_adm));
CREATE TABLE tbl_eventos (id_evn int(11) NOT NULL AUTO_INCREMENT,nombre_evn varchar(50) NOT NULL,descripcion_evn varchar(255),color_evn varchar(8),desde_evn datetime NOT NULL, hasta_evn datetime NOT NULL, hora_inicio_evn varchar(10) NOT NULL,hora_final_evn varchar(10) NOT NULL,fecha_evn datetime DEFAULT current_timestamp(),id_usr int(11) NOT NULL,PRIMARY KEY (id_evn),FOREIGN KEY (id_usr) REFERENCES tbl_usuario(id_usr));
CREATE TABLE tbl_pomodoro(id_pmd int(11) NOT NULL AUTO_INCREMENT,fecha_hora_pmd datetime,nombre_pmd varchar(30) NOT NULL,actividad_pmd varchar(8),pausa_corta_pmd varchar(8) NOT NULL,pausa_larga_pmd varchar(8) NOT NULL,id_usr int(11) NOT NULL,PRIMARY KEY (id_pmd),FOREIGN KEY (id_usr) REFERENCES tbl_usuario (id_usr));
CREATE TABLE tbl_Recordatorios(id_rec int(11) AUTO_INCREMENT,Nombre_rec varchar(75),Color_rec varchar(8),Fecha_rec TIMESTAMP DEFAULT CURRENT_TIMESTAMP,Notificacion_rec DATETIME,id_usr int(11),PRIMARY KEY(id_rec),FOREIGN KEY(id_usr) REFERENCES tbl_usuario(id_usr));  
CREATE TABLE tbl_archivo(id_arc int(11),nombre_arc varchar(75),color_arc varchar(8),fecha_arc DATETIME,fecha_del_arc TIMESTAMP DEFAULT CURRENT_TIMESTAMP,notificacion_arc DATETIME,id_usr int(11),PRIMARY KEY(id_arc),FOREIGN KEY(id_usr) REFERENCES tbl_usuario(id_usr));

-- Trigger
DELIMITER $$
CREATE TRIGGER historial
AFTER DELETE ON tbl_Recordatorios
FOR EACH ROW 
BEGIN
INSERT INTO tbl_archivo(id_arc, nombre_arc, color_arc, fecha_arc, notificacion_arc, id_usr) VALUES(old.id_rec, old.nombre_rec, old.color_rec, old.fecha_rec, old.Notificacion_rec, old.id_usr);
END $$
DELIMITER ;